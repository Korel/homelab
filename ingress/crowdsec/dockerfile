FROM crowdsecurity/crowdsec:latest

# Copy staging configs so cscli works during build
RUN mkdir -p /etc/crowdsec && cp -a /staging/etc/crowdsec/* /etc/crowdsec/

# Install collections
RUN cscli collections install crowdsecurity/caddy
RUN cscli collections install Dominic-Wagner/vaultwarden
RUN cscli collections install LePresidente/authelia

# Custom entrypoint: copies /staging configs to /etc/crowdsec on first run
# This allows persisting /etc/crowdsec as a volume while keeping configs intact
COPY entrypoint.sh /custom-entrypoint.sh
RUN chmod +x /custom-entrypoint.sh
ENTRYPOINT ["/custom-entrypoint.sh"]
